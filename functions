get_hash_id() {
  result=$($1|sum|cut -d' ' -f1)
}

get_color_index() {
  # There are 7 colors and black then use them cyclic.
  result=$(($1 % 7 + 1))
}

get_prompt_color_indexes() {
  get_hash_id "whoami"; get_color_index $result
  local user=$result
  get_hash_id "hostname"; get_color_index $result
  local host=$result
  get_color_index $(($SHLVL + 2))
  local shlvl=$result
  result=($user $host $shlvl)
}

init_locale() {
  export LANG="ja_JP.UTF-8"
  export LC_COLLATE="ja_JP.UTF-8"
  export LC_CTYPE="UTF-8"
  export LC_MESSAGES="ja_JP.UTF-8"
  export LC_MONETARY="ja_JP.UTF-8"
  export LC_NUMERIC="ja_JP.UTF-8"
  export LC_TIME="ja_JP.UTF-8"
  export LC_ALL="ja_JP.UTF-8"
}

init_paths() {
  for i in /opt/local /usr/local; do
    local bin_path="$i/bin"
    if [ -d "$bin_path" ]; then
      PATH=$bin_path:$PATH
    fi

    local sbin_path="$i/sbin"
    if [ -d "$sbin_path" ]; then
      PATH=$sbin_path:$PATH
    fi
    local man_path="$i/share/man"
    if [ -d "$man_path" ]; then
      MANPATH=$man_path:$MANPATH
    fi
  done
  PATH=$PATH:~/bin
}

init_editor() {
  export EDITOR=/Applications/MacVim.app/Contents/MacOS/Vim
  alias vi='env LANG=ja_JP.UTF-8 /Applications/MacVim.app/Contents/MacOS/Vim "$@"'
  alias vim='env LANG=ja_JP.UTF-8 /Applications/MacVim.app/Contents/MacOS/Vim "$@"'
}

init_rbenv() {
  eval "$(rbenv init -)"
  if [ -f ~/.rbenv/completions/rbenv.bash ]; then
    source ~/.rbenv/completions/rbenv.bash
  fi
}

init_virtualenv() {
  export WORKON_HOME=$HOME/.virtualenvs
  if [ -d $WORKON_HOME ]; then
    mkdir -p $WORKON_HOME
  fi

  which virtualenvwrapper.sh > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    source `which virtualenvwrapper.sh`
  fi

  alias mkve=mkvirtualenv
  alias rmve=rmvirtualenv
  alias lsve=lsvirtualenv
}

setup_go_env() {
  local GOPATH=`which go`
  local GODIR=`dirname $GOPATH`
  local GOPATH_BREW_RELATIVE=`readlink $GOPATH`
  local GOPATH_BREW=`dirname $GOPATH_BREW_RELATIVE`
  export GOROOT=`cd $GODIR; cd $GOPATH_BREW/../libexec; pwd`
}

init_go() {
  setup_go_env
  export GOPATH=$HOME
  export GOBIN=$GOROOT/bin
  export PATH=$PATH:$GOROOT/bin:$GOPATH/bin
}

p() { peco | while read LINE; do $@ $LINE; done }

aliases() {
  alias ll='ls -l'
  alias git='hub'
  alias chrome='open -a "Google Chrome" "$@"'
}

function peco-src() {
  local selected_dir=$(ghq list --full-path | peco --query "$LBUFFER")
  if [ -n "$selected_dir" ]; then
    BUFFER="cd  ${selected_dir}"
    zle accept-line
  fi
  zle clear-screen
}

function agvim() {
  vim $(ag $@ | peco --query "$LBUFFER" | awk -F : '{print "-c" $2 " " $1}')
}

init_envs() {
  export DOCKER_HOST=tcp://127.0.0.1:4243
  export PATH=$HOME/.nodebrew/current/bin:$PATH
}

init_embulk() {
  export PATH=$PATH:$HOME/.embulk/bin
}
